<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Devis MELEC - RS Components</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
    .container { max-width: 1000px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); overflow: hidden; }
    .header { background: linear-gradient(90deg, #1a5fb4, #007acc); color: white; padding: 20px; text-align: center; }
    .header img { max-height: 60px; margin-bottom: 10px; }
    .header h1 { font-size: 1.8em; margin-bottom: 5px; }
    .section { padding: 20px; border-bottom: 1px solid #eee; }
    .section:last-child { border-bottom: none; }
    .section h2 { color: #1a5fb4; margin-bottom: 15px; font-size: 1.3em; }
    select, input, textarea { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px; margin-bottom: 10px; }
    .btn { background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; margin-right: 10px; }
    .btn:hover { background: #218838; }
    .btn-danger { background: #dc3545; }
    .btn-danger:hover { background: #c82333; }
    .btn-secondary { background: #6c757d; margin-top: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
    th { background: #f8f9fa; font-weight: bold; }
    .total { font-size: 1.4em; font-weight: bold; color: #1a5fb4; text-align: right; margin-top: 15px; }
    .prof-tools { background: #fff3cd; border-left: 4px solid #ffc107; }
    .import-zone { background: #d4edda; border-left: 4px solid #28a745; }
    .logo-zone { border: 3px dashed #1a5fb4; padding: 20px; text-align: center; border-radius: 8px; margin: 15px 0; cursor: pointer; background: #f8f9ff; }
    .logo-zone:hover { background: #e8f0ff; }
    .logo-zone.dragover { background: #d4eaff; border-color: #007acc; }
    @media (max-width: 768px) { .container { margin: 10px; border-radius: 8px; } .btn { width: 100%; margin: 5px 0; } }
  </style>
</head>
<body>

<div class="container">

  <!-- EN-T√äTE SOCI√âT√â -->
  <div class="header" id="header">
    <img id="logo" src="https://via.placeholder.com/200x60/1a5fb4/ffffff?text=LOGO" alt="Logo">
    <h1 id="entrepriseNom">√âLEC INSTALL SARL</h1>
    <p id="entrepriseInfo">12 rue des Circuits<br>94000 Cr√©teil<br>SIRET : 123 456 789 00012 | T√©l : 01 23 45 67 89</p>
  </div>

  <!-- PROJET & CLIENT -->
  <div class="section">
    <h2>üìã Projet & Client</h2>
    <input type="text" id="projet" placeholder="Nom du projet (ex : Installation studio T2)" value="Installation studio T2">
    <input type="text" id="client" placeholder="Nom client (ex : M. Martin)" value="M. Martin">
  </div>

  <!-- IMPORT LISTE RS -->
  <div class="section import-zone">
    <h2>üì• Importer liste Radiospares</h2>
    <p><em>1. Cr√©e liste sur <a href="https://fr.rs-online.com" target="_blank">fr.rs-online.com</a><br>2. Export CSV ‚Üí Glisse ici !</em></p>
    <input type="file" id="importCSV" accept=".csv" style="width: 100%; padding: 10px;">
    <div id="importPreview" style="background: white; padding: 15px; border-radius: 6px; max-height: 200px; overflow-y: auto; display: none;"></div>
    <button class="btn" onclick="importerListeRS()">üöÄ Importer dans devis</button>
  </div>

  <!-- AJOUT MANUEL -->
  <div class="section">
    <h2>‚ûï Ajout manuel</h2>
    <select id="ref">
      <option value="">S√©lectionner mat√©riel...</option>
      <option value="schneider-acti9-16a" data-prix="8.50" data-marque="Schneider">Acti9 iC60N 16A C (8.50‚Ç¨)</option>
      <option value="legrand-dx3-16a" data-prix="9.20" data-marque="Legrand">DX¬≥ 16A C (9.20‚Ç¨)</option>
      <option value="schneider-diff-40a" data-prix="45.00" data-marque="Schneider">Acti9 40A 30mA (45.00‚Ç¨)</option>
    </select>
    <div style="display: flex; gap: 10px; align-items: end;">
      <input type="number" id="qteManuel" value="1" min="1" style="width: 80px;">
      <button class="btn" onclick="ajouterManuel()">‚ûï Ajouter</button>
    </div>
  </div>

  <!-- MAIN D'OEUVRE -->
  <div class="section">
    <h2>‚è±Ô∏è Main d'≈ìuvre</h2>
    <label>Heures estim√©es : 
      <input type="number" id="heuresPose" value="4" min="0" step="0.5" style="width: 100px; display: inline;">
    </label>
    <div style="font-size: 18px; margin-top: 10px;">
      <strong>Main d'≈ìuvre :</strong> <span id="coutMainOeuvre">180,00</span> ‚Ç¨ HT
    </div>
  </div>

  <!-- DEVIS FINAL -->
  <div class="section">
    <h2>üí∞ Devis complet</h2>
    <table id="tableau">
      <thead>
        <tr><th>Article</th><th>Marque</th><th>Qt√©</th><th>Prix U. HT</th><th>Total</th></tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
    <div class="total">
      Mat√©riel HT : <span id="sousTotalMat">0,00</span> ‚Ç¨<br>
      Main d'≈ìuvre : <span id="sousTotalMO">0,00</span> ‚Ç¨<br>
      <strong>SOUS-TOTAL HT : <span id="sousTotal">0,00</span> ‚Ç¨</strong><br>
      TVA 20,00% : <span id="tva">0,00</span> ‚Ç¨<br>
      <strong>TOTAL TTC : <span id="totalTTC">0,00</span> ‚Ç¨</strong>
    </div>
    <button class="btn" onclick="imprimerFacture()">üñ®Ô∏è Imprimer Facture PDF</button>
    <button class="btn btn-secondary" onclick="exporterCSV()">üìä Liste Mat√©riel CSV</button>
    <button class="btn btn-danger" onclick="viderPanier()">üóëÔ∏è Vider panier</button>
  </div>

  <!-- CONFIG SOCI√âT√â + LOGO UPLOAD -->
  <div class="section prof-tools">
    <h2>üè¢ Configuration Soci√©t√©</h2>
    
    <input type="text" id="newEntreprise" placeholder="Nom soci√©t√© (ex : √âLEC INSTALL SARL)">
    
    <textarea id="newAdresse" rows="3" placeholder="Adresse compl√®te&#10;12 rue des Circuits&#10;94000 Cr√©teil&#10;SIRET : 12345678900012 | T√©l : 01 23 45 67 89"></textarea>
    
    <div class="logo-zone" onclick="document.getElementById('logoFile').click()">
      <p>üñºÔ∏è <strong>Glisser votre LOGO ici</strong> ou cliquer</p>
      <p style="font-size: 12px; color: #666;">PNG/JPG/PDF - max 1 Mo</p>
      <img id="logoPreview" src="https://via.placeholder.com/200x60/1a5fb4/ffffff?text=LOGO+PNG" style="max-height: 60px; margin-top: 10px; border-radius: 4px; border: 2px solid #ddd;">
    </div>
    <input type="file" id="logoFile" accept="image/*" style="display: none;">
    
    <label>Taux horaire HT : 
      <input type="number" id="tauxHoraire" step="0.01" value="45.00" style="width: 120px;">
    </label>
    
    <button class="btn" onclick="sauvegarderConfig()">üíæ Sauvegarder tout</button>
    <button class="btn btn-secondary" onclick="resetConfig()">üîÑ R√©initialiser</button>
  </div>

</div>

<script>
// √âTAT APPLICATION
let panier = JSON.parse(localStorage.getItem('panierMELEC')) || [];
let config = JSON.parse(localStorage.getElementById('configEntreprise')) || {
  nom: '√âLEC INSTALL SARL',
  adresse: '12 rue des Circuits\n94000 Cr√©teil
